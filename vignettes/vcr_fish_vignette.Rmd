---
title: "vcr_fish_vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vcr_fish_vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(alohakez)
library(tidyverse)
```

## take a look at data first
```{r}
vcr_fish %>% head()
summary(vcr_fish)
typeof(vcr_fish$sample_date)
typeof(vcr_fish$sample_time)
```

## data pre-processing
```{r}
vcr_fish <- vcr_fish %>%
  mutate( sample_date=as.Date(sample_date, "%Y-%m-%d") ) %>%
  mutate(sample_year=as.numeric( format(sample_date, format = "%Y") ),
         sample_month=as.numeric( format(sample_date, format = "%m") ),
         sample_day=as.numeric( format(sample_date, format = "%d") )
         )
vcr_fish <- vcr_fish %>%
  mutate(sample_hour=as.numeric(
              format(as.POSIXct(sample_time, format = "%H:%M"), format = "%H")
              ),
         sample_min=as.numeric(
           format(as.POSIXct(sample_time, format = "%H:%M"), format = "%M")
           )
        )
```

### check
```{r}
sapply(vcr_fish, typeof)
```

## look at fish length
```{r}
vcr_fish %>%
  ggplot() +
  geom_histogram(aes(x=length), binwidth=30)
```
#### there is one super long fish, seems to vary across spieces

# let's see how many species were measured
```{r}
vcr_fish %>%
  count(count) 
```
# filter out Na row for count & length since we focus on fish for now
```{r}
fish <- vcr_fish %>% filter(!is.na(count) & !is.na(length)) 
```

### We want to know how many of each species do we have
```{r}
species_count <- fish %>%
  group_by(species_name) %>%
  summarise(total_count=sum(count))
species_count
```
#### from the plot, we can see there are 32 species in this data

```{r}
species_count %>%
  ggplot(aes(y=species_name) ) +
  geom_bar(aes(weight = total_count))
```

```{r}
main_species <- species_count %>% filter(total_count>200)
main_species <- main_species %>% 
  arrange(total_count) %>% 
  pull(species_name)
main_species
```
#### "Bay Anchovy"  "Silver Perch" "Silversides"  "Pinfish"  "Pipefish"


## Look at pipefish, since it was measured the most by the scientists
```{r}
pipefish_r <- fish %>% 
  filter(species_name==main_species[5])

pipefish_r %>% filter(count!=1)
pipefish_r %>% arrange(desc(count)) %>% head()
```
#### there are rows where the count is bigger than one, if we want to analyze the data, it shuld be taken into account that those rows are weighed more

### duplicate rows
```{r}
pipe50fish <-pipefish_r %>% arrange(desc(count)) %>% slice(rep(1, each=50-1))
pipe2fish <- pipefish_r %>% arrange(desc(count)) %>% slice(rep(2, each=2-1))
pipefish <- pipefish_r %>%
  bind_rows(pipe2fish) %>%
  bind_rows(pipe50fish) 
```


# see length
```{r}
pipefish %>%
  ggplot() +
  geom_histogram(aes(x=length), binwidth=8) +
  #geom_density() +
  #geom_density(aes(y=..density..), alpha=0.6)+
  labs(title="Histogram of Length of Pipefish")
```
#### we can see there are two clusters


### see if any relationship with other vars


### Look at pinfish
```{r}
pinfish <- fish %>% 
  filter(species_name=="Pinfish")
pinfish %>% filter(count!=1)
```

#### see length
```{r}
pinfish %>%
  ggplot() +
  geom_histogram(aes(length), binwidth=10) 
```

```{r}
long_pinfish <- pinfish %>% arrange(desc(length)) %>% head(1) %>% pull(length)
```
#### let's take out that value
```{r}
pinfish <- pinfish %>% filter(length!=long_pinfish)
```

```{r}
pinfish %>%
  ggplot() +
  geom_histogram(aes(length), binwidth=10) 
```

## Look at silversides
```{r}
silversides_r <- fish %>% 
  filter(species_name=="Silversides")

silversides_r %>% filter(count!=1) %>% arrange(desc(count)) #%>%
  #distinct(count)
```
### duplicate rows
```{r}
silver2fish <- silversides_r %>% filter(count==2) %>% slice(rep(1:n(), each = 2-1))
silver3fish <- silversides_r %>% filter(count==3) %>% slice(rep(1:n(), each = 3-1))
silver5fish <- silversides_r %>% filter(count==5) %>% slice(rep(1:n(), each = 5-1))
silver6fish <- silversides_r %>% filter(count==6) %>% slice(rep(1:n(), each = 6-1))
silver19fish <- silversides_r %>% filter(count==19) %>% slice(rep(1:n(), each = 19-1))
silver56fish <- silversides_r %>% filter(count==56) %>% slice(rep(1:n(), each = 56-1))
silversides <- silversides_r %>%
  bind_rows(silver2fish,
            silver3fish,
            silver5fish,
            silver6fish,
            silver19fish,
            silver56fish) 
```

### draw
```{r}
silversides %>%
  ggplot() +
  geom_histogram(aes(length), binwidth=10) 
```
## draw desnity plot of these 3 fishes
```{r}
bind_rows(pipefish, pinfish, silversides) %>%
  ggplot(aes(x=length)) +
  geom_histogram(aes(y = ..density.., fill=species_name, color=species_name), binwidth = 5) +
  geom_density(aes(fill=species_name), alpha = 1, size=0.2)
```

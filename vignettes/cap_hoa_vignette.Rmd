---
title: "cap_hoa_vignette: Homeowner Associations (HOA) as a Vehicle for Promoting Native Urban Biodiversity (Central Arizonaâ€“Phoenix LTER)"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{cap_hoa_vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  message = FALSE, warning = FALSE
)
```

```{r setup}
library(lterdatasets)
library(tidyverse)
library(rstatix)
library(GGally)
```

## Homeowner Associations (HOA) as a Vehicle for Promoting Native Urban Biodiversity

#### Background Information
"Phoenix has experienced dramatic land-use and land-cover change over the past 20 years as it has become one of the fastest growing American cities (U.S. Census Bureau 2000). Virtually all new development during this period used HOA management. Such patterns of rapid growth dominated by HOA management are not unique to Phoenix; subdivisions across the United States face similar challenges of improving biodiversity potential in planned communities." \
This data is from a study that investigated the relationship between HOAs and biodiversity in Phoenix, Arizona, through the CAP LTER project. The scientists focused on 39 of the 204 long-term monitoring plots, all located in residential land uses. \

**Take a look at data**
```{r}
cap_hoa %>% head()
sapply(cap_hoa, typeof)
cap_hoa <- cap_hoa %>% mutate(hoa=factor(hoa)) # factor hoa
sapply(cap_hoa, typeof)
```
```{r}
cap_hoa %>% filter(!is.na(nat_bird)) %>% group_by(hoa) %>% count()
cap_hoa %>% filter(!is.na(plnt)) %>% group_by(hoa) %>% count()
cap_hoa %>% filter(!is.na(arthropod)) %>% group_by(hoa) %>% count()
```
Roughly half of all monitoring sites belonged to a HOA \
 

## Diversity relationships 

Compute summary statistics for native bird diversity, plant diversity, and arthropod diversity
```{r}
diversity <- cap_hoa %>% select(c(site, hoa, nat_bird:arthropod))
diversity %>%
  group_by(hoa) %>%
  get_summary_stats(nat_bird:arthropod, type = "common") %>% arrange(variable)
```
Compare native bird diversity, plant diversity, and arthropod diversity between neighborhoods with and without a HOA \
```{r fig.height=3.2, fig.width=8}
diversity_label <- c("Native Bird", "Plant", "Arthropod")
names(diversity_label) <- c("nat_bird", "plnt", "arthropod")
diversity %>% 
  gather(diversity_type, value, nat_bird:arthropod) %>%
  ggplot(aes(x=diversity_type, y=value)) +
  geom_boxplot(aes(color=hoa), size=0.4, position=position_dodge(1)) +
  geom_jitter(aes(color=hoa, shape=hoa), position=position_dodge(1)) +
  facet_wrap(vars(diversity_type), scales = "free", labeller = labeller(diversity_type =diversity_label)) +
  labs(x="", y = "Diversity Indices")
```

**two-sample t-test** \
Even though the t-test is reasonably robust to non-normality, it may deviate the type 1 error rate and the power of the test. \
```{r fig.height=7, fig.width=6}
diversity %>%
  gather(diversity_type, value, nat_bird:arthropod) %>%
  ggplot(aes(x=value)) +
  geom_histogram(aes(fill=hoa), binwidth = 0.3) +
  facet_wrap(vars(diversity_type, hoa), nrow=3, scales = "free", labeller = labeller(diversity_type =diversity_label)) +
  labs(x= "Diversity Indices")
```
some of these histograms do not look normal, we can test the normality by using the Shapiro-Wilk test. The test rejects the hypothesis of normality when the p-value is less than or equal to 0.05. \
```{r}
diversity %>% 
  group_by(hoa) %>% shapiro_test(nat_bird, plnt, arthropod) %>% arrange(variable)
```
From the plots above, there seems to be an neighborhood with HOA with extremely low native bird diversity. \
```{r}
diversity %>% filter(nat_bird<1) 
nat_bird_outlier <- cap_hoa %>% filter(hoa==1 & nat_bird<1) 
```

Peform t-test 
```{r}
diversity %>% t_test(nat_bird ~ hoa)
diversity %>% filter(nat_bird!=nat_bird_outlier$nat_bird) %>% t_test(nat_bird ~ hoa)
```
Native bird diversity differed between the two groups of neighborhoods, and showed a trend toward increased diversity in neighborhoods with HOAs. When we excluded the one neighborhood with extremely low native bird diversity, the relationship is significant. \

```{r}
diversity %>% t_test(plnt ~ hoa)
```
Neighborhoods belonging to a HOA had significantly greater plant diversity than neighborhoods not belonging to a HOA. \
```{r}
diversity %>% t_test(arthropod ~ hoa)
```
Arthropod diversity did not differ between the two neighborhood types, which is also evident from the box plot above.


## other features
Let's look at the Household income, Neighborhood age (yr), Distance to wildlands (m), Impervious surface (%), and the number of trees \
```{r fig.width=10, fig.height=3}
features <- cap_hoa %>% select(c(site, hoa, income:num_te))
features %>%
  gather(feature, value, income:num_te) %>%
  ggplot(aes(x=feature, y=value)) +
  geom_boxplot(aes(color=hoa), size=0.4, position=position_dodge(1)) +
  geom_jitter(aes(color=hoa, shape=hoa), position=position_dodge(1)) +
  facet_wrap(vars(feature), nrow=1, scales = "free")
```
Household income, amount of impervious surface, and distance to wildlands do not differ much between the neighborhood types. \
The range of housing age for neighborhoods that do not belong to HOA is much wider than those that do belong to HOA. Newer neighborhoods were slightly more likely to have a HOA. \
The boxplot for number of trees is a little crowded. Plot it separately \
```{r}
features %>% 
  ggplot(aes(hoa, num_te, color=hoa, shape=hoa)) + 
  geom_boxplot(fill=NA, outlier.shape = NA, alpha=0.5, size=0.2)+
  geom_jitter(aes(), size=1.3, position=position_jitter(0.08)) +
  labs(x="", y= "Number of Trees")
features %>%
  group_by(hoa) %>%
  get_summary_stats(num_te, type = "common")
```
There is an extreme outlier. We can remove the outlier and plot again
```{r}
features %>% filter(num_te < 60) %>%
  ggplot(aes(hoa, num_te, color=hoa, shape=hoa)) + 
  geom_boxplot(fill=NA, outlier.shape = NA, alpha=0.5, size=0.2)+
  geom_jitter(aes(), size=1.3, position=position_jitter(0.08)) +
  labs(x="", y= "Number of Trees")
features %>%
  group_by(hoa) %>% filter(num_te<60) %>%
  get_summary_stats(num_te, type = "common")
```

Is the number of trees related to the biodiversity? \
```{r fig.height=5.5, fig.width=9.5}
tree_diversity <- cap_hoa %>% select(hoa, nat_bird:arthropod, num_te) %>% 
  gather(diversity_type, value, -hoa, -num_te) 
tree_diversity$diversity_type <- factor(tree_diversity$diversity_type, c("nat_bird", "plnt", "arthropod"))
tree_diversity %>%
  ggplot(aes(x=num_te, y=value, color=hoa)) +
  geom_point(size=2) +
  facet_wrap(vars(hoa, diversity_type), ncol=3, scales = "free", labeller = labeller(diversity_type =diversity_label)) +
  labs(x= "Number of Trees", y= "Diversity Indices") +
  theme_grey()
# Removing the extreme outlier and plot again
tree_diversity %>% filter(num_te<60) %>% 
  ggplot(aes(x=num_te, y=value, color=hoa)) +
  geom_point(size=2) +
  facet_wrap(vars(hoa, diversity_type), ncol=3, scales = "free", labeller = labeller(diversity_type =diversity_label)) +
  labs(x= "Number of Trees", y= "Diversity Indices") +
  theme_grey()
```

Scatterplot matrix and Pearson correlation between number of trees and diversity indices
```{r fig.height=7, fig.width=8}
cap_hoa %>% select(hoa, nat_bird:arthropod, num_te) %>%
  ggpairs(columns=2:5, aes(colour=hoa), proportions = "auto") +
  theme_light()
cap_hoa %>% select(hoa, nat_bird:arthropod, num_te) %>% filter(num_te<60) %>%
  ggpairs(columns=2:5, aes(colour=hoa), proportions = "auto")
```



# Citation

Lerman, S. 2016. Homeowner Associations as a vehicle for promoting native urban biodiversity ver 1. Environmental Data Initiative. https://doi.org/10.6073/pasta/e7fb691d6b4bf6974ece085f22ab63fc (Accessed 2021-05-03).


# How we processed the raw data

`r knitr::spin_child(here::here("data-raw","cap_hoa.R"))`
